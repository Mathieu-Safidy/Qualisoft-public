server {
    listen 80;
    server_name localhost;

    # Location for the Angular application's static files
    location / {
        # The root is where NGINX will look for files
        root /usr/share/nginx/html;
        # Tries to find a file or directory that matches the URI.
        # If not found, it serves index.html, which is essential for single-page applications.
        try_files $uri $uri/ /index.html;
    }

    # Location for the API requests
    # All requests starting with /api/ will be handled here
    location /qualisoft/api/ {
        # The proxy_pass directive routes the request to the specified backend.
        # This is the key part for routing to a Kubernetes service.
        # The format is http://<service-name>.<namespace>.svc.cluster.local:<port>
        proxy_pass http://qualisoft-microservice-service.luminess-microservice.svc.cluster.local:80/;

        # Important headers for proper communication with the backend service
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Rewrite the URI to remove the /api prefix before sending it to the backend.
        # This is a common and often necessary step.
        # For example, a request to `/api/users` is routed to `/users` on the backend service.
        rewrite ^/(.*)$ /$1 break;
    }
}